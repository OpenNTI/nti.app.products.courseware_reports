<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE document SYSTEM "rml_1_0.dtd">
<document filename="ForumParticipationReport.pdf"
		  invariant="1"
		  compression="1"
		  title="Forum Participation Report"
		  creator="NextThought"
		  author="NextThought"
		  xmlns:tal="http://xml.zope.org/namespaces/tal"
		  xmlns:metal="http://xml.zope.org/namespaces/metal">

	<template pagesize="(842,595)" leftMargin="72" showBoundary="0"
			  metal:define-macro="template">
		<pageTemplate id="cover" autoNextTemplate="main">
			<frame id="main_header"
				   x1="0.5in" y1="7in"
				   width="7in" height="1in"
				   showBoundary="1" />
			<frame id="first" x1="0.5in" y1="0.5in" width="7in" height="9in"/>
		</pageTemplate>
		<pageTemplate id="main">
			<frame id="first" x1="0.5in" y1="0.5in" width="7in" height="10in"/>
		</pageTemplate>

		<pageTemplate id="two_charts">
			<frame id="two_charts_main" x1="0.5in" y1="0.5in" width="7in" height="10in"/>
			<frame id="callout" x1="6in" y1="1in" width="8in" height="5in" showBoundary="1" />
		</pageTemplate>
		
	</template>

	<stylesheet metal:define-macro="stylesheet">
		<paraStyle 	name="report_title" 
					fontSize="20" 
					alignment='right' spaceAfter=".2in" 
					textColor="#494949" fontName="Helvetica"/>
	
		<paraStyle name="h1" fontSize="30" textColor="#494949" fontName="Helvetica"/>
		
		<paraStyle name="h2" fontSize="15" textColor="#494949" fontName="Helvetica" keepWithNext="true"
					spaceBefore=".5in" spaceAfter=".3in"/>
		
		<paraStyle name="normal" fontName="Helvetica" fontSize="12" textColor="#494949"
				   leading="15" spaceAfter=".5in" />
		
		<paraStyle name="subdesc" fontName="Helvetica" fontSize="10" textColor="#494949"
				   leading="13" spaceAfter=".5in" />
		
		<paraStyle name="sendTo" leftIndent="0.5in" parent="normal" textColor="#494949"
				   spaceBefore="10"/>

<!-- It doesn't appear this works with header rows for some reason.
	 Set values for the table and manually convert the headers.		
		<blockTableStyle id="default">
			<lineStyle 	start="0,0" stop="-1,0" 
						kind="linebelow" 
						thickness="1"
					   	colorName="#e9e9e9"/>
		
			<blockTextColor start="0,0" stop="-1,0" colorName="#b8b8b8" />
			<blockFont start="0,0" stop="-1,0" name="Helvetica-Bold" size="10" />
			<blockTextColor start="0,0" stop="-1,-1" colorName="#494949" />
			<blockFont start="0,0" stop="-1,-1" name="Helvetica" size="12" />
		</blockTableStyle>
-->		
		<blockTableStyle id="default">
			<lineStyle start="0,0" stop="-1,-1" kind="innergrid" thickness="0.25"
					   colorName="black"/>
			<blockRightPadding start="0,0" stop="-1,-1" length="3mm"/>
		</blockTableStyle>

		<blockTableStyle id="header_table">
		</blockTableStyle>
	</stylesheet>

	<story firstPageTemplate="cover">
		<image file="[nti.appserver]/templates/coppa_consent_header.png"
			   width="3.5in"
			   height="0.55in"
			   x="0.5in" y="7in"
			   align="left"
			   metal:define-macro="header_graphic" />

		<tal:block metal:define-macro="header">
			<img metal:use-macro="macro:header_graphic" />
			<blockTable alignment='right' style="header_table"
						tal:content="structure provider:header_table">
			</blockTable>
			<nextFrame />
		</tal:block>

	<illustration width="8in" height="2.8in"
		  metal:define-macro="forum_participation_over_time">
		<!--! To use, define a variable 'forum_stat' and 'value_axis_name around the invocation -->
		<barChart dx="0.5in" dy="0in"
				  dwidth="5in" dheight="3in"
				  x="0" y="0"
				  width="8in"
				  height="2.8in" direction="vertical" 
				  barLabelFormat="%2.0f" barWidth="5"
				  tal:condition="forum_stat/forum_objects_by_week_number">
			<barLabels fillColor="#757474" fontSize="12" boxAnchor="s" dy="3" />
			<bars>
				<bar fillColor="#53a2db" strokeColor="#53a2db" />
			</bars>
			<categoryAxis visibleTicks="false" strokeColor="#e9e9e9"
						tal:attributes="categoryNames forum_stat/forum_objects_by_week_number_categories"
						tal:condition="forum_stat/forum_objects_by_week_number">
				<labels fontName="Helvetica" fontSize="10" fillColor="#b8b8b8"/>
			</categoryAxis>
			<valueAxis 	valueMin="0" valueMax="15"
						visibleTicks="false" visibleAxis="false" visibleGrid="true"
						gridStrokeWidth="1" gridStrokeColor="#e9e9e9"
						rangeRound="ceiling"
						maximumTicks="10"
						tal:attributes="valueMax forum_stat/forum_objects_by_week_number_max;
										valueStep forum_stat/forum_objects_by_week_number_y_step"
						tal:condition="forum_stat/forum_objects_by_week_number">
				<labels fontName="Helvetica" fontSize="10" fillColor="#b8b8b8" />
			</valueAxis>
			<texts >
				<text x="4in" y="-0.6in" textAnchor="middle"
					  fontName="Helvetica-Bold" fontSize="16"
					  fillColor="#757474" >
					Week Number (${forum_stat/forum_objects_by_week_number_category_subheader})
				</text>
				<text x="1.6in" y="0.5in" angle="90" textAnchor="middle"
					  fontName="Helvetica-Bold" fontSize="16"
					  fillColor="#757474" 
					  tal:content="value_axis_name">
					Forum Participation
				</text>
			</texts>
			<data>
				<series tal:condition="forum_stat/forum_objects_by_week_number"
						tal:content="forum_stat/forum_objects_by_week_number_series">
				</series>
			</data>
		</barChart>
	</illustration>


	<metal:macro metal:define-macro="comment_table" >
		<blockTable alignment="left" colWidths="60% 12% 12%" style="default">
			<tr>
				<td>Name</td>
				<td>Count</td>
				<td>Percent</td>
			</tr>
			<tr tal:repeat="item python: [x for x in top_commenters] ">
				<td tal:content="item/display">Display Name</td>
				<td align="decimal" tal:content="item/count">count</td>
				<td align="decimal" tal:content="python: '%0.1f%%' % item.perc">percent</td>
			</tr>
		</blockTable>
	</metal:macro>

	<illustration width="4in" height="4in"
				  metal:define-macro="forum_top_commenters"
				  tal:attributes="width top_commenters_ill_width|default;
								  height top_commenters_ill_height|default">
					
		<!-- We prefer to use a pie-chart, unless there is a remainder (e.g. 'aggregate').  
			If so, we will fall back to a bar chart.  -->			
								  
		<barChart dx="0in" dy="0in"
				  dwidth="4in" dheight="4in"
				  x="1.3in" y="0"
				  width="3.5in"
				  height="4in" direction="horizontal" 
				  barLabelFormat="%2d" barWidth="5"
				  tal:condition="top_commenters/aggregate" >
			<barLabels fillColor="#757474" fontSize="12" boxAnchor="w" dx="3" />
			<bars>
				<bar fillColor="#ffbe4d" strokeColor="#ffbe4d" />
			</bars>
			<categoryAxis visibleTicks="false" strokeColor="#e9e9e9"
						reverseDirection="true"
						tal:attributes="categoryNames python: ' '.join(['%s' % x.display for x in top_commenters])"
						tal:condition="top_commenters|options/top_commenters">
				<labels fontName="Helvetica" fontSize="10" fillColor="#b8b8b8"/>
			</categoryAxis>
			<valueAxis 	valueMin="0" valueMax="15"
						visibleTicks="false" visibleAxis="false" visibleGrid="true"
						gridStrokeWidth="1" gridStrokeColor="#e9e9e9"
						rangeRound="ceiling"
						maximumTicks="10"
						tal:condition="top_commenters|options/top_commenters"
						tal:attributes="valueMax python: max([x.count for x in top_commenters]) + 1" >
				<labels fontName="Helvetica" fontSize="10" fillColor="#b8b8b8" />
			</valueAxis>
			<texts >
				<text x="3.2in" y="-0.6in" textAnchor="middle"
					  fontName="Helvetica-Bold" fontSize="12"
					  fillColor="#757474" >
					Number of Comments
				</text>
			</texts>
			<data>
				<series tal:content="top_commenters/series|options/top_commenters/series">
					100
					75
					25
				</series>
			</data>
		</barChart>	
		
		<pieChart dx="0in" dy="0in"
				  dwidth="4in" dheight="4in"
				  x="1in" y="0"
				  width="4in" height="4in"
				  checkLabelOverlap='false'
				  tal:condition="not: top_commenters/aggregate|options/top_commenters/aggregate"
				  tal:attributes="dwidth top_commenters_ill_width|default;
								  dheight top_commenters_ill_height|default;
								  width top_commenters_chart_width|default;
								  height top_commenters_chart_height|default">
			<labels>
				<label tal:repeat="item top_commenters|options/top_commenters"
					   tal:content="python: item.display + ' (%0.1f%%)' % item.perc">User1</label>
				<label tal:condition="False">User2</label>
				<label tal:condition="False">User3</label>
			</labels>
			<slices>
				<!-- The last element is the "everyone else"; it has a
				larger percent then its slice size indicates, so draw
				attention to that by popping it out -->
				<slice tal:repeat="item top_commenters|options/top_commenters"
					   tal:attributes="popout python:10 if repeat.item.end else 0;
									   fillColor python:top_commenters_colors[repeat.item.number]" />
			</slices>
			<data>
				<series tal:content="top_commenters/series|options/top_commenters/series">
					100
					75
					25
				</series>
			</data>
		</pieChart>		
	</illustration>

	</story>
</document>
